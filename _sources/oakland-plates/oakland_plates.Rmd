---
jupyter:
  jupytext:
    notebook_metadata_filter: all,-language_info
    split_at_heading: true
    text_representation:
      extension: .Rmd
      format_name: rmarkdown
      format_version: '1.2'
      jupytext_version: 1.13.7
  kernelspec:
    display_name: Python 3
    language: python
    name: python3
---

# Oakland license plates

```{python}
# The array library.
import numpy as np
# Data frame library.
import pandas as pd
# Library for plotting maps.
import folium
```

See [background](background.Rmd) for the background to this notebook.


We're going to look at some data collected by the Oakland
Police Department. They have automated license plate readers on
their police cars, and they've built up a database of license
plates that they've seen â€” and where and when they saw each one.


## The data


We load the cleaned license plate data from the file we saved earlier.

Notice that we are telling Pandas that the `Timestamp` column has a date/time
values. Otherwise, Pandas will load these values as strings.  We could have
done that, and converted them later, but loading them this way saves some time.

Make sure you have run the [data preparation notebook](clean_plates.Rmd) before
you run the cell below.


```{python}
# Load all license plate data.
# This will probably take about 30 seconds, depending on your machine.
lprs = pd.read_csv('all_lprs.csv.gz', parse_dates=['Timestamp'])
lprs
```

**Note** If you get a `FileNotFound` error, check you have run the [data
                                                                    preparation
                                                                    notebook](clean_plates.Rmd).
It writes out the data file that the you are reading above.

Notice that we have about 2.7 million license plate reads.

Let's start by seeing what can be learned about someone, using this data â€”
assuming you know their license plate


## Searching for Individuals


As a warmup, we'll take a look at ex-Mayor [Jean
Quan](https://en.wikipedia.org/wiki/Jean_Quan)'s car, and where it has been
seen.  Her license plate number is 6FCH845. (How did I learn that?  Turns out
she was in the news for getting \$1000 of parking tickets, and [the news
article](http://www.sfgate.com/bayarea/matier-ross/article/Jean-Quan-Oakland-s-new-mayor-gets-car-booted-3164530.php)
included a picture of her car, with the license plate visible. You'd be amazed
by what's out there on the Internet...)

```{python}
jean_quan = lprs[lprs['Plate'] == '6FCH845']
jean_quan
```

OK, so her car shows up 6 times in this data set.  Let's put those on a map, to
see if we can learn anything from these reads.

For background, we will also put a marker on the Oakland Police Department and
the Oakland City Hall:


```{python}
OAK_PD_COORDS = (37.79926910804871, -122.27497697421084)
OAK_CITY_HALL_COORDS = (37.805498393033204, -122.2725551318817)

# Map of Oakland, centered on the Police Department
oak_map = folium.Map(location=OAK_PD_COORDS,
                     tiles='OpenStreetMap',
                     zoom_start=15)
# Jean Quan's reads.
for i, row in jean_quan.iterrows():
    folium.Marker(
        [row['Latitude'], row['Longitude']],
        popup=row['Timestamp'],
        icon=folium.Icon(icon='car', prefix='fa')
    ).add_to(oak_map)

# Police Department
folium.Marker(OAK_PD_COORDS,
              popup='Police Dept',
              icon=folium.Icon(color='lightgray', icon='info-sign')
             ).add_to(oak_map)


# City Hall
folium.Marker(OAK_CITY_HALL_COORDS,
              popup='City Hall',
              icon=folium.Icon(color='lightgray', icon='info-sign')
             ).add_to(oak_map)

# Show the map
oak_map
```

OK, so it's been seen near the Oakland police department.  This should make you suspect we might be getting a bit of a biased sample.  Why might the Oakland PD be the most common place where her car is seen?  Can you come up with a plausible explanation for this?


## Poking around


Let's try another.  And let's see if we can make the map a little more fancy.
It'd be nice to distinguish between license plate reads that are seen during
the daytime (on a weekday), vs the evening (on a weekday), vs on a weekend.  So
we'll color-code the markers.  To do this, we'll write some Python code to
analyze the 'Timestamp' and choose an appropriate color.

```{python}
def get_color(ts):
    if ts.weekday() >= 6:
        return 'green' # Weekend
    elif ts.hour >= 6 and ts.hour <= 17:
        return 'blue' # Weekday daytime
    else:
        return 'red' # Weekday evening


# Apply the function to the Timestamp column, make new column.
lprs['Color'] = lprs['Timestamp'].apply(get_color)
lprs.head()
```

Now we can check out another license plate, this time with our spiffy
color-coding.  This one happens to be the car that the city issues to the Fire
Chief.  At the time this was [Teresa Deloach
Reed](https://localwiki.org/oakland/Teresa_Deloach_Reed).

```{python}
fire_chief = lprs[lprs['Plate'] == '1328354']
fire_chief
```

```{python}
oak_map = folium.Map(location=OAK_PD_COORDS,
                     tiles='OpenStreetMap',
                     zoom_start=12)
for i, row in fire_chief.iterrows():
    folium.Marker(
        [row['Latitude'], row['Longitude']],
        popup=row['Timestamp'],
        icon=folium.Icon(color=row['Color'], icon='car', prefix='fa')
    ).add_to(oak_map)

# City Hall
folium.Marker(OAK_CITY_HALL_COORDS,
              popup='City Hall',
              icon=folium.Icon(color='lightgray', icon='info-sign')
             ).add_to(oak_map)

oak_map
```

Hmm.  We can see a blue cluster in downtown Oakland, where the Fire Chief's car
was seen on weekdays during business hours.  I bet we've found her office.  As
you can see from the 'City Hall' marker, those are mostly clustered right near
City Hall.  Also, her car was seen twice in northern Oakland on weekday
evenings.  One can only speculate what that indicates.  Maybe dinner with a
friend?  Or running errands?  Off to the scene of a fire?  Who knows.  And then
the car has been seen once more, late at night on a weekend, in a residential
area in the hills.  Her home address, maybe?


Let's look at another. This time, we'll make a function to display the map.

```{python}
someone = lprs[lprs['Plate'] == '6UZA652']
oak_map = folium.Map(location=OAK_PD_COORDS,
                     tiles='OpenStreetMap',
                     zoom_start=12)
for i, row in someone.iterrows():
    folium.Marker(
        [row['Latitude'], row['Longitude']],
        popup=row['Timestamp'],
        icon=folium.Icon(color=row['Color'], icon='car', prefix='fa')
    ).add_to(oak_map)
oak_map
```

What can we learn from this map?  First, it's pretty easy to guess where this person lives: 16th and International, or pretty near there.  And then we can see them spending some nights and a weekend near Laney College.  Did they have an apartment there briefly?  A relationship with someone who lived there?


## So ... who should see these data?


* Who should have access to these data?
* Is there anything we can do to make these data less dangerous in terms of
  privacy, while maintaining their use for monitoring police surveillance?


## Notes

* [Electronic Frontier Foundation
  discussion](https://www.eff.org/deeplinks/2015/01/what-we-learned-oakland-raw-alpr-data)
* <https://www.eastbaytimes.com/2021/09/04/oakland-police-give-fbi-unfettered-access-to-license-plate-reader-data-according-to-lawsuit>
* <https://oaklandside.org/2021/02/08/oaklands-privacy-commission-wants-police-license-plate-surveillance-canceled/>
* <https://arstechnica.com/tech-policy/2015/03/we-know-where-youve-been-ars-acquires-4-6m-license-plate-scans-from-the-cops>
* <https://www.nbcsandiego.com/news/local/license-plate-surveillance-prompts-new-concerns-about-your-privacy/48722/>
